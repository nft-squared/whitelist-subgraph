type Account @entity {
    "user information"
    id: ID!
    address: String!
    referenceCode: String!
    isVIPRefer: bool!
    
    auths: [Auth!] @derivedFrom(field: "account")
    winners: [RoundWinner!] @derivedFrom(field: "winner")
}

type Auth @entity {
    "user authorized tokens"
    id: ID!
    account: Account!
    txHash: String!
    tokenAddr: String!
    tokenID: Int!
}

type Bucket @entity {
    "bucket"
    id: ID!
    state: BucketState!
    address: String!
    txHash: String!
    creator: Account!

    uri: String!
    name: String!
    description: String!
    discord: String!
    twitter: String!
    website: String!
    whitelistPerRound: Int!
    numRounds: Int!
    mintPrice: Int!
    mintToken: String!
    chain: String!
    launchDate: Date!
    referral: String

    createTime: Int!
    rounds: [BucketRound!] @derivedFrom(field: "bucket")
}

type BucketRound @entity {
    "bucket rounds"
    id: ID!
    state: RoundState
    bucket: Bucket!
    round: Int!
    tickets: Int!

    raffleTime: Date
    txHash: String
    result: [RoundWinner!] @derivedFrom(field: "round")
}

type RoundWinner @entity {
    "raffle result"
    id: ID!
    round: BucketRound!

    winner: User!
    numberWhitelist: Int!
}

enum BucketState {
    "pending"
    "active"
    "closed"
}

enum RoundState {
    "pending"
    "done"
}

type Epoch @entity {
    "epoch information, including weights and timestamp"
    id: ID!
    epoch: Int!
    state: EpochState
    weights: [TokenWeight!]! @derivedFrom(field: "epoch")

    currentTimestamp: Date
    nextEpoch: Int
    nextTimestamp: Date
}

type TokenWeight @entity {
    "token weight for each epoch"
    id: ID!
    epoch: Epoch
    tokenAddress: String!
    weight: Int!
}

enum EpochState {
    "active"
    "transitioning"
    "expired"
}

type System @entity {
    "pricing and constant"
    """
    E.g. A new user added authorization worth 1000 tokens / day
        If he does not have reference code, 
            1. He will get (bonusBaseMulti / bonusDenom) * 1000 gold tickets
        If he fill in a normal reference code, 
            1. He will get (bonusBaseMulti + bonusReferMulti) / bonusDenom * 10000 gold tickets
            2. His friend will get (bonusReferalMulti / bonusDenom) * 1000 gold tickets
        If he fill in a VIP reference code,
            1. He will get (bonusBaseMulti + bonusVIPMulti) / bonusDenom * 10000 gold tickets
            2. VIP will get (bonusReferalMulti / bonusDenom) * 1000 gold tickets
    """
    bonusBaseMulti: Int!
    bonusReferMulti: Int!
    bonusVIPMulti: Int!
    bonusReferalMulti: Int!
    bonusDenom: Int!

    bucketPrice: Float!
}
